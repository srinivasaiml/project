<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fishbowl - Save the fish (Full House!)</title>
    <style>
        :root {
            /* CSS variable for water level, controlled by JavaScript */
            --filling: 90;
        }

        html {
            font-size: 5vh;
        }

        @media screen and (min-height: 400px) {
            html {
                font-size: 19px;
            }
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            /* MODIFIED: New animated underwater gradient background */
            background: linear-gradient(135deg, #004e63, #009490, #48c9b0, #004e63);
            background-size: 400% 400%;
            animation: background-pan 25s ease infinite;
            overflow: hidden;
            position: relative; /* Needed for z-index context of children */
        }

        /* --- KEYFRAME ANIMATIONS --- */

        /* MODIFIED: More fluid background movement */
        @keyframes background-pan {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* ADDED: Keyframes for the new background bubbles */
        @keyframes bubble-rise {
            0% { transform: translateY(0); }
            100% { transform: translateY(-120vh); }
        }

        @keyframes swimming {
            0%   { transform: translate(0, 0) rotateZ(0deg); }
            15%  { transform: translate(3rem, -1rem) rotateZ(-5deg); }
            45%  { transform: translate(7rem, 1rem) rotateZ(5deg); }
            60%  { transform: translate(6rem, -0.5rem) rotateZ(0deg) scaleX(-1); }
            90%  { transform: translate(1rem, -1rem) rotateZ(-10deg) scaleX(-1); }
            100% { transform: translate(0, 0) rotateZ(0deg) scaleX(1); }
        }

        @keyframes flex-body {
            0%, 100% { transform: skewX(0deg); }
            25% { transform: skewX(4deg); }
            75% { transform: skewX(-4deg); }
        }

        @keyframes wiggle-tail {
            0%, 100% { transform: rotateZ(0deg); }
            50% { transform: rotateZ(-25deg); }
        }
        
        @keyframes flap-fin {
            0%, 100% { transform: rotateZ(10deg); }
            50% { transform: rotateZ(-10deg); }
        }
        
        @keyframes blink-eye {
            0%, 95%, 100% { transform: scaleY(1); }
            97% { transform: scaleY(0.1); }
        }

        @keyframes wave {
            from { top: 25%; left: 25%; width: 50%; height: 50%; opacity: 0.5; }
            to { top: 10%; left: 10%; width: 80%; height: 80%; opacity: 0; }
        }

        @keyframes stream {
            0% { height: 0; }
            50% { top: 2rem; height: calc(14rem - var(--filling) * 0.1rem); }
            100% { top: calc(2rem + 14rem - var(--filling) * 0.1rem); height: 0; }
        }

        @keyframes handle {
            from { transform: rotate(45deg); }
            to { transform: rotate(405deg); }
        }
        
        @keyframes sway {
            0% { transform: rotateZ(0deg); }
            50% { transform: rotateZ(5deg); }
            100% { transform: rotateZ(0deg); }
        }
        
        @keyframes bubbles-rise {
            from { bottom: 1rem; opacity: 0; transform: translateX(0); }
            50% { opacity: 1; }
            to { bottom: 90%; opacity: 0; transform: translateX(1rem); }
        }

        @keyframes scuttle {
            0%, 100% { transform: translateX(-0.5rem); }
            50% { transform: translateX(0.5rem); }
        }

        @keyframes pinch {
            0%, 70%, 100% { transform: rotate(0deg); }
            85% { transform: rotate(25deg); }
        }
        
        @keyframes shrimp-hop {
            0%, 10%, 100% { transform: translateY(0) rotateZ(0); }
            5% { transform: translateY(-0.5rem) rotateZ(-10deg); }
        }
        
        /* --- ADDED: Background Bubble Styles --- */
        .background-bubbles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* Place behind everything */
            overflow: hidden;
        }

        .background-bubbles span {
            position: absolute;
            bottom: -50px; /* Start below the screen */
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: bubble-rise linear infinite;
        }

        /* Creating variation in bubbles */
        .background-bubbles span:nth-child(1) { width: 20px; height: 20px; left: 10%; animation-duration: 15s; }
        .background-bubbles span:nth-child(2) { width: 40px; height: 40px; left: 20%; animation-duration: 12s; animation-delay: 2s; }
        .background-bubbles span:nth-child(3) { width: 15px; height: 15px; left: 35%; animation-duration: 20s; }
        .background-bubbles span:nth-child(4) { width: 50px; height: 50px; left: 50%; animation-duration: 10s; animation-delay: 4s; }
        .background-bubbles span:nth-child(5) { width: 30px; height: 30px; left: 65%; animation-duration: 18s; }
        .background-bubbles span:nth-child(6) { width: 25px; height: 25px; left: 80%; animation-duration: 13s; animation-delay: 1s; }
        .background-bubbles span:nth-child(7) { width: 10px; height: 10px; left: 90%; animation-duration: 22s; }


        /* --- FISHBOWL STYLES --- */

        .fishbowl {
            position: relative;
            width: 15rem;
            height: 15rem;
        }
        
        .fishbowl__background {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 50% 50% 40% 40%;
            background: linear-gradient(transparent 10%, #FFF 150%);
            border-bottom: 1px solid #FFF;
        }
        
        .fishbowl:before {
            content: "";
            position: absolute;
            bottom: 9.5rem;
            left: 2rem;
            width: 100%;
            height: 30%;
            border-radius: 50%;
            box-shadow: -4rem 10rem 1rem 0 rgba(0, 0, 56, 0.3);
            transform: rotate(5deg);
        }
        
        .fishbowl:after {
            content: "";
            position: absolute;
            top: 12.5%;
            left: 2.5%;
            width: 95%;
            height: 85%;
            border-radius: 40%;
            background: linear-gradient(135deg, transparent 50%, #FFF 150%);
        }
        
        .fishbowl__bottom {
            position: absolute;
            bottom: 5%;
            left: 17.5%;
            width: 65%;
            height: 20%;
            border-radius: 50%;
            background: linear-gradient(#F5FCCD, #ff7d66 200%);
        }
        
        .fishbowl__decoration {
            position: absolute;
            top: 20%;
            left: 5%;
            width: 90%;
            height: 75%;
        }
        
        .fishbowl__seaweed {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 0.5rem solid transparent;
            border-right: 0.5rem solid transparent;
            transform-origin: bottom center;
        }
        
        .fishbowl__seaweed--1 {
            bottom: 15%; right: 20%;
            border-bottom: 5rem solid #80c0a1;
            animation: sway 4s ease-in-out infinite alternate;
        }
        
        .fishbowl__seaweed--2 {
            bottom: 10%; right: 30%;
            border-bottom: 8rem solid #80c0a1;
            animation: sway 5s ease-in-out infinite alternate;
        }
        
        .fishbowl__seaweed--3 {
            bottom: 15%; right: 40%;
            border-bottom: 6rem solid #80c0a1;
            animation: sway 3s ease-in-out infinite alternate;
        }
        
        .fishbowl__water {
            position: absolute;
            bottom: 5%; left: 5%;
            width: 90%;
            height: calc(1% * var(--filling, 90));
            border-radius: 0 0 4.8rem 4.8rem;
            transition: height 0.5s linear;
            overflow: hidden;
            z-index: 2; /* Ensure water is above decorations */
        }

        .fishbowl__water-color {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(transparent -50%, #419197 250%);
            border-radius: 20% 20% 4rem 4rem;
        }
        
        .fishbowl__water-color:after {
            content: "";
            position: absolute;
            top: 0; left: 5%;
            width: 90%; height: 3rem;
            border-radius: 50%;
            background: linear-gradient(transparent 0%, #419197 250%);
            box-shadow: inset 0 -1px 0 0 rgba(255, 255, 255, 0.5);
        }
        
        .fishbowl__top {
            position: absolute;
            top: 5%; left: 15%;
            width: 70%; height: 20%;
            border-radius: 50%;
            box-shadow: 0 2px 2px 3px rgba(255, 255, 255, 0.3);
            z-index: 5;
        }
        
        /* --- AQUATIC CREATURES STYLES --- */

        .fishbowl__fish {
            position: absolute;
            bottom: 25%; left: 15%;
            width: 4rem;
            height: 3rem;
            animation: swimming 8s cubic-bezier(0.45, 0, 0.55, 1) infinite;
            transition: bottom 1s ease, box-shadow 1s ease;
            filter: drop-shadow(0 2rem 4px rgba(0, 0, 56, 0.3));
        }

        .fishbowl__fish-svg { width: 100%; height: 100%; overflow: visible; }
        .fish-body { animation: flex-body 2s ease-in-out infinite; transform-origin: center; }
        .fish-tail { animation: wiggle-tail 0.5s ease-in-out infinite; transform-origin: 20% 50%; }
        .fish-fin-side { animation: flap-fin 1s ease-in-out infinite alternate; transform-origin: 30% 20%; }
        .fish-eye { animation: blink-eye 6s linear infinite; transform-origin: center; }

        .fishbowl__fish--dying {
            bottom: 10%;
            filter: drop-shadow(0 1rem 4px rgba(0, 0, 56, 0.3));
        }
        .fishbowl__fish--dying .fish-body,
        .fishbowl__fish--dying .fish-tail,
        .fishbowl__fish--dying .fish-fin-side { animation-duration: 4s; }
        .fishbowl__fish--dying .fish-body { fill: url(#fish-gradient-dying); }

        .fishbowl__fish--dead { animation-play-state: paused; filter: none; }
        .fishbowl__fish--dead .fish-body,
        .fishbowl__fish--dead .fish-tail,
        .fishbowl__fish--dead .fish-fin-side,
        .fishbowl__fish--dead .fish-eye { animation: none !important; }
        .fishbowl__fish--dead .fish-eye { transform: scaleY(0.1); }
        
        .fishbowl__fish--floating {
            bottom: max(calc(var(--filling, 0) * 0.8% + 5%), 5%);
            transform: translate(2.5rem, 0) rotateZ(180deg);
            animation: none;
            filter: none;
        }
        
        .fishbowl__crab {
            position: absolute;
            bottom: 12%; left: 30%;
            width: 3rem; height: auto;
            z-index: 1;
            animation: scuttle 10s ease-in-out infinite;
        }
        .crab__pincer--left { transform-origin: 80% 80%; animation: pinch 4s linear infinite 0.5s; }
        .crab__pincer--right { transform-origin: 20% 80%; animation: pinch 5s linear infinite reverse; }

        .fishbowl__shrimp {
            position: absolute;
            bottom: 15%; right: 25%;
            width: 1.5rem; /* Very small */
            height: auto;
            z-index: 1;
            animation: shrimp-hop 7s ease-in-out infinite;
            animation-delay: 2s; /* Desync from other animations */
        }

        /* --- TAP & OTHER ELEMENTS --- */
        
        .fishbowl__pool {
            position: absolute;
            right: 0; bottom: -5%;
            width: 50%; height: 15%;
            border-radius: 50%;
            background: linear-gradient(#FFF -100%, #419197);
            opacity: 0.5;
        }
        
        .fishbowl__pool:after {
            content: "";
            position: absolute;
            top: 25%; left: 25%;
            width: 50%; height: 50%;
            border-right: 2px solid #FFF;
            border-radius: 50%;
            animation: wave 3s infinite;
        }
        
        .fishbowl__tap {
            position: absolute;
            bottom: 0; left: -3rem;
            width: 12rem; height: 15.9rem;
            cursor: pointer;
            z-index: 10;
        }
        
        .fishbowl__tap--active .fishbowl__tap-stream { animation: stream 0.5s; }
        .fishbowl__tap--active .fishbowl__tap-handle { animation: handle 0.5s; }
        
        .fishbowl__tap-base {
            position: absolute; bottom: 0; left: 0; width: 2rem; height: 14rem;
            border-radius: 0 0 1.2rem 1.2rem;
            box-shadow: inset -1px -1px 0 0px rgba(255, 255, 255, 0.5);
            background: linear-gradient(#919ea3, #66777F 150%);
        }
        .fishbowl__tap-base:before {
            content: ""; position: absolute; z-index: -1; bottom: 4rem; right: 15rem; width: 100%; height: 100%;
            border-radius: 1rem 1rem 0 0;
            box-shadow: -4rem 10rem 1rem 0 rgba(0, 0, 56, 0.3);
            transform: rotate(-70deg);
        }
        .fishbowl__tap-base:after {
            content: ""; position: absolute; bottom: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4) 60%, transparent 200%);
            border-radius: 0 0 1.2rem 1.2rem;
        }
        
        .fishbowl__tap-handle {
            position: absolute; left: -1rem; bottom: 6rem; width: 2rem; height: 2rem;
            border-radius: 0.2rem;
            border-top: 1px solid #FFF;
            border-right: 1px solid rgba(255, 255, 255, 0.5);
            background: radial-gradient(circle at 0 0, #FFF -100%, #919ea3);
            transform: rotate(45deg);
        }
        .fishbowl__tap-handle:after {
            content: ""; position: absolute; top: 0.5rem; left: 0.5rem; width: 1rem; height: 1rem;
            border-radius: 50%;
            background: radial-gradient(circle at 0 0, #FFF -200%, #419197);
        }
        
        .fishbowl__tap-stream {
            position: absolute; top: 2rem; left: 6.25rem; width: 1.5rem; height: 0;
            background: linear-gradient(#FFF -100%, #419197);
            border-radius: 1rem;
            opacity: 0.3;
        }
        
        .fishbowl__tap-head {
            position: absolute; top: 0; left: 0; width: 4rem; height: 0rem;
            border-radius: 50% 50% 0 0;
            border-top: 2rem solid #919ea3;
            border-left: 2rem solid #919ea3;
            border-right: 2rem solid #919ea3;
            box-shadow: 1px -1px 0 0 #FFF;
        }
        .fishbowl__tap-head:before {
            content: ""; position: absolute; z-index: -1; bottom: 3rem; right: 23rem; width: 150%; height: 200%;
            box-shadow: -4rem 10rem 1rem 1rem rgba(0, 0, 56, 0.3);
            transform: rotate(2deg) skewX(60deg);
        }
        .fishbowl__tap-head:after {
            content: ""; position: absolute; top: -2rem; left: -2rem; width: 8rem; height: 2rem;
            background: linear-gradient(transparent, rgba(255, 255, 255, 0.4) 60%, transparent 200%);
            border-radius: 50% 50% 0 50%;
        }
        
        .fishbowl__tap-end {
            position: absolute; left: 6rem; top: 1.5rem; width: 2rem; height: 1rem;
            border-radius: 50%;
            background: linear-gradient(#FFF -70%, #919ea3);
        }
        
        .fishbowl__tap-text {
            position: absolute; top: 4rem; left: -6rem; color: #FFF; font-family: "Arial", sans-serif; font-size: 0.875rem;
            text-shadow: 1px 1px 2px #000;
        }
        .fishbowl__tap-text:after {
            content: ""; position: absolute; bottom: -1rem; right: -1rem; width: 2rem; height: 1px;
            background-color: #FFF; transform: rotate(45deg);
        }

        /* --- UI & BUBBLES --- */

        .game-over-text {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-family: 'Arial', sans-serif;
            font-weight: bold;
            color: #ff4757;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            pointer-events: none;
            z-index: 100;
        }
        .game-over-text.visible { opacity: 1; }

        .fishbowl__bubbles {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 100%;
        }

        .bubble {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            animation: bubbles-rise 5s ease-in-out infinite;
        }

        .bubble:nth-child(1) { width: 10px; height: 10px; left: 15%; animation-duration: 6s; animation-delay: 0s; }
        .bubble:nth-child(2) { width: 8px; height: 8px; left: 40%; animation-duration: 4s; animation-delay: 1s; }
        .bubble:nth-child(3) { width: 12px; height: 12px; left: 70%; animation-duration: 5s; animation-delay: 2.5s; }
        .bubble:nth-child(4) { width: 6px; height: 6px; left: 85%; animation-duration: 7s; animation-delay: 0.5s; }
        .bubble:nth-child(5) { width: 10px; height: 10px; left: 50%; animation-duration: 4.5s; animation-delay: 3s; }
        
        @media screen and (max-width: 420px) {
            .fishbowl { left: 13%; }
            .fishbowl__tap-text { width: 2rem; top: 1rem; left: -3.5rem; }
        }
    </style>
</head>
<body>

    <!-- ADDED: New Animated Background Container -->
    <div class="background-bubbles">
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
    </div>

    <!-- Main Fishbowl Structure -->
    <div id="fishbowl" class="fishbowl">
        <div class="fishbowl__pool"></div>
        <div class="fishbowl__background"></div>
        <div class="fishbowl__bottom"></div>
        <div class="fishbowl__decoration">
            <div class="fishbowl__seaweed fishbowl__seaweed--1"></div>
            <div class="fishbowl__seaweed fishbowl__seaweed--2"></div>
            <div class="fishbowl__seaweed fishbowl__seaweed--3"></div>
            
            <div class="fishbowl__crab">
                <svg viewBox="0 0 100 60">
                    <defs>
                        <radialGradient id="crab-gradient">
                            <stop offset="0%" stop-color="#e74c3c" />
                            <stop offset="100%" stop-color="#c0392b" />
                        </radialGradient>
                    </defs>
                    <g fill="url(#crab-gradient)">
                        <path d="M10 40 Q 5 50 0 45 Z" /> <path d="M15 45 Q 10 55 5 50 Z" />
                        <path d="M90 40 Q 95 50 100 45 Z" /> <path d="M85 45 Q 90 55 95 50 Z" />
                        <path d="M10 40 C 0 20, 100 20, 90 40 Q 50 50 10 40 Z" />
                        <path d="M20 30 Q 0 20 10 10 L 30 25 Z" />
                        <path class="crab__pincer--left" d="M10 10 Q 20 5 25 15 Z" />
                        <path d="M80 30 Q 100 20 90 10 L 70 25 Z" />
                        <path class="crab__pincer--right" d="M90 10 Q 80 5 75 15 Z" />
                    </g>
                    <circle cx="40" cy="30" r="3" fill="#2c3e50" /> <circle cx="60" cy="30" r="3" fill="#2c3e50" />
                </svg>
            </div>

            <div class="fishbowl__shrimp">
                <svg viewBox="0 0 50 50">
                    <defs>
                        <linearGradient id="shrimp-gradient">
                            <stop offset="0%" stop-color="#ff7e5f" />
                            <stop offset="100%" stop-color="#feb47b" />
                        </linearGradient>
                    </defs>
                    <g fill="none" stroke="url(#shrimp-gradient)" stroke-width="4" stroke-linecap="round">
                        <path d="M10 40 C 30 50, 40 30, 40 10" />
                        <path d="M40 10 Q 45 5 48 8" />
                        <path d="M40 10 Q 35 5 32 8" />
                    </g>
                </svg>
            </div>
        </div>

        <div id="water" class="fishbowl__water">
            <div class="fishbowl__bubbles">
                <div class="bubble"></div> <div class="bubble"></div> <div class="bubble"></div> <div class="bubble"></div> <div class="bubble"></div>
            </div>

            <div id="fish" class="fishbowl__fish">
                <svg viewBox="0 0 100 60" class="fishbowl__fish-svg">
                    <defs>
                        <linearGradient id="fish-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff9900;" /> <stop offset="100%" style="stop-color:#ff6600;" />
                        </linearGradient>
                        <linearGradient id="fish-gradient-dying" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffcc80;" /> <stop offset="100%" style="stop-color:#ffa366;" />
                        </linearGradient>
                    </defs>
                    <g class="fish-body" style="fill: url(#fish-gradient);">
                        <path class="fish-tail" d="M15,30 C0,15 0,45 15,30 Z" />
                        <path d="M15,30 C40,0 70,0 85,25 C90,30 90,30 85,35 C70,60 40,60 15,30 Z" />
                        <path class="fish-fin-top" d="M50,11 C55,5 65,5 70,11 L60,13 Z" />
                        <path class="fish-fin-side" d="M70,30 C65,25 65,35 75,32 Z" />
                    </g>
                    <circle class="fish-eye" cx="78" cy="27" r="3" fill="#2c3e50" />
                </svg>
            </div>
            
            <div class="fishbowl__water-color"></div>
        </div>
        <div class="fishbowl__top"></div>
        <div id="tap" class="fishbowl__tap">
            <div class="fishbowl__tap-base"></div>
            <div class="fishbowl__tap-handle"></div>
            <div class="fishbowl__tap-stream"></div>
            <div class="fishbowl__tap-end"></div>
            <div class="fishbowl__tap-head"></div>
            <div class="fishbowl__tap-text">Click to refill</div>
        </div>
    </div>
    
    <div id="gameOver" class="game-over-text">GAME OVER!</div>

    <script>
        let fill = 90;
        let intervalId = null;
        let isGameOver = false;
        
        const fishbowl = document.getElementById('fishbowl');
        const fish = document.getElementById('fish');
        const tap = document.getElementById('tap');
        const gameOverText = document.getElementById('gameOver');
        
        const emptyingFn = () => setInterval(() => {
            if (fill <= 0 && !isGameOver) {
                isGameOver = true;
                fill = 0;
                fish.classList.add('fishbowl__fish--floating'); 
                gameOverText.classList.add('visible'); 
                clearInterval(intervalId);
                return;
            }
            
            if (isGameOver) return;

            fill = fill - 1;
            fishbowl.style.setProperty('--filling', fill);
        
            if (fill < 20) {
                fish.classList.add('fishbowl__fish--dead');
                fish.classList.remove('fishbowl__fish--dying');
            } else if (fill < 50) {
                fish.classList.add('fishbowl__fish--dying');
            }
        }, 200);
        
        intervalId = emptyingFn();
        
        tap.addEventListener('click', () => {
            tap.classList.add('fishbowl__tap--active');
            setTimeout(() => tap.classList.remove('fishbowl__tap--active'), 500);
            
            if (isGameOver) {
                isGameOver = false;
                intervalId = emptyingFn();
            }
            
            fill = Math.min(fill + 20, 90);

            gameOverText.classList.remove('visible');
            fish.classList.remove('fishbowl__fish--dying', 'fishbowl__fish--dead', 'fishbowl__fish--floating');
        });
    </script>
</body>
</html>
